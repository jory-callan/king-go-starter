# ======================
# 基础日志配置
# ======================
log:
  level: "info"       # 日志级别: debug, info, warn, error, fatal
  format: "json"      # 日志格式: json, text
  output: "stdout"    # 输出目标: stdout, 文件路径（如 /var/log/app.log）
  file_path: "/var/log/app.log" # 日志文件路径
  max_size: 100       # 单个日志文件最大大小(MB)
  max_backups: 5      # 保留的旧日志文件数量
  max_age: 7          # 旧日志文件保留天数(天)
  compress: true      # 是否压缩旧日志文件
  caller_skip: 2     # 跳过调用栈的层数

# ======================
# HTTP 服务配置
# ======================
http:
  enableDebug: false
  host: "0.0.0.0"     # 监听地址
  port: 8080          # 监听端口
  read_timeout: 10s   # 读取请求超时时间
  write_timeout: 10s  # 写入响应超时时间
  idle_timeout: 60s   # 空闲连接超时时间
  max_header_bytes: 1MB   # 最大允许的请求头大小 (支持 KB, MB, GB)
  max_body_size: 10MB   # 最大允许的请求体大小 (支持 KB, MB, GB)
  # CORS 跨域配置
  cors:
    allow_origins: ["https://example.com", "http://localhost:3000"]  # 允许的源
    allow_methods: ["GET", "POST", "PUT", "DELETE", "OPTIONS"]      # 允许的 HTTP 方法
    allow_headers: ["Content-Type", "Authorization"]                # 允许的请求头
    expose_headers: ["X-Request-ID"]                                # 暴露给客户端的响应头
    max_age: 86400                                                  # 预检请求缓存时间(秒)
  # 限流配置 (可选)
  rate_limit:
    enabled: true       # 是否启用限流
    requests_per_second: 100  # 每秒允许的请求数
    burst: 20           # 突发请求允许的最大数量

# ======================
# 数据库配置 (支持多实例)
# ======================
# 配置格式：database.[instance].[配置项]
# 必须有一个 default 实例，默认使用的也是 default
database:
  default:            # 默认实例（必填）
    driver: "mysql"   # 驱动类型: mysql, postgresql, sqlite3
    dsn: "root:password@tcp(127.0.0.1:3306)/dbname?charset=utf8mb4&parseTime=True&loc=Local"
    max_open_conns: 100   # 最大打开连接数
    max_idle_conns: 10    # 最大空闲连接数
    conn_max_lifetime: 30m   # 连接最大存活时间
    conn_max_idle_time: 5m   # 连接最大空闲时间
    log_level: "warn"   # 日志级别: silent, error, warn, info
#    tablePrefix: ""     # 表名前缀

  primary:            # 主数据库实例（主从读写分离的主库）
    driver: "mysql"
    dsn: "user:pass@tcp(127.0.0.1:3306)/dbname?charset=utf8mb4&parseTime=True&loc=Local"
    max_open_conns: 100
    max_idle_conns: 10
    conn_max_lifetime: 30m
    conn_max_idle_time: 5m
    log_level: "warn"

  replica:            # 从数据库实例（只读）
    driver: "mysql"
    dsn: "user:pass@tcp(127.0.0.1:3307)/dbname?charset=utf8mb4&parseTime=True&loc=Local"
    max_open_conns: 50
    max_idle_conns: 5
    conn_max_lifetime: 30m
    log_level: "error"

  analytics:          # 分析数据库实例（SQLite示例）
    driver: "sqlite3"
    dsn: "./data/analytics.db"
    max_open_conns: 10
    max_idle_conns: 2
    conn_max_lifetime: 30m
    log_level: "info"

# ======================
# Redis 配置 (支持多实例 & 多 Driver)
# ======================
redis:
  cache:              # 缓存用途的 Redis 实例
    addr: "127.0.0.1:6379"  # Redis 地址
    password: ""            # 密码 (无密码则留空)
    db: 0                   # 数据库索引
    pool_size: 100          # 连接池大小
    min_idle_conns: 10      # 最小空闲连接数

  session:            # Session 存储用途的 Redis 实例 (可选)
    addr: "127.0.0.1:6380"
    password: "sess_pass"
    db: 1
    pool_size: 50

# ======================
# 缓存配置 (支持多 Driver: Redis, Memcached, 本地缓存)
# ======================
cache:
  default:
    driver: "redis"         # 缓存驱动: redis, memcached, local
    ttl: 30m                # 默认缓存过期时间
    # 如果是 Redis 驱动，复用 redis.cache 的配置
    # 如果是 Memcached 驱动:
    # servers: ["127.0.0.1:11211"]
    # 如果是 Local 驱动:
    # size: 1000  # 本地缓存最大条目数

# ======================
# JWT 配置
# ======================
jwt:
  secret: "your-32-char-secret-key-here"
  expires: "24h"    # 24小时过期
  issuer: "myapp"   # 签发者

# ======================
# 消息队列 (Kafka / RabbitMQ / 其他)
# ======================
mq:
  kafka:
    brokers: ["127.0.0.1:9092"]  # Kafka Broker 列表
    topic: "app_events"          # 默认 Topic
    group_id: "app_consumer"     # 消费者组 ID
    partition: 0                 # 默认分区
    offset: "latest"             # 消费偏移量: earliest, latest

  rabbitmq:
    url: "amqp://guest:guest@localhost:5672/"  # RabbitMQ 连接 URL
    exchange: "app_events"                     # 默认交换机
    queue: "app_queue"                         # 默认队列

# ======================
# 服务发现与注册 (如 Consul, Etcd, Nacos)
# ======================
service_discovery:
  enabled: true
  driver: "consul"  # 驱动: consul, etcd, nacos
  address: "127.0.0.1:8500"  # 服务发现服务器地址
  service_name: "my-go-app"  # 当前服务名称
  service_port: 8080         # 当前服务端口
  health_check_path: "/health"  # 健康检查接口路径

# ======================
# 链路追踪 (如 Jaeger, Zipkin, OpenTelemetry)
# ======================
tracing:
  enabled: true
  driver: "jaeger"  # 驱动: jaeger, zipkin, otel
  endpoint: "http://jaeger:14268/api/traces"  # Jaeger 收集器地址
  service_name: "my-go-app"
  sample_rate: 0.1  # 采样率 (0.0 ~ 1.0)